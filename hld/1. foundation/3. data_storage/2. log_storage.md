# Log-structured storage engines

Many databases internally use a log[^1], which is an append-only data file. Appending to a file(write operation) is generally very efficient.

### Hash [Indexes](https://github.com/gauxs/sysd/blob/data_intensive/hld/1.%20foundation/3.%20data_storage/readme.md#index)

The simplest possible indexing strategy is this: keep an in-memory hash map where every key is mapped to a byte offset in the data fileâ€”the location at which the value can be found.

#### How do we avoid eventually running out of disk space?

A good solution is to break the log into segments of a certain size by closing a segment file when it reaches a certain size, and making subsequent writes to a new segment file. We can then perform compaction[^2] on these segments. We can also merge several segments together at the same time as performing the compaction

[^1]: an append-only sequence of records.
[^2]: compaction means throwing away duplicate keys in the log, and keeping only the most recent update for each key.
